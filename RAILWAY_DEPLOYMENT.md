# Railway Deployment Guide

This guide provides detailed instructions for deploying OpenClaw to Railway using this template.

## Quick Deploy

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/clawdbot-railway-template)

Click the button above to deploy with one click.

## What Gets Deployed

When you deploy this template to Railway, you'll get:

- **OpenClaw Gateway + Control UI** - Full-featured AI assistant gateway
- **Setup Wizard** - Web-based configuration at `/setup` (password protected)
- **Persistent Storage** - Railway Volume mounted at `/data` for state and workspace
- **Automatic Backups** - Export functionality to backup your configuration
- **Multi-platform Support** - Telegram, Discord, Slack bot support

## Prerequisites

Before deploying, ensure you have:

1. A Railway account ([sign up here](https://railway.app))
2. (Optional) Bot tokens ready:
   - **Telegram**: Get from [@BotFather](https://t.me/BotFather)
   - **Discord**: Get from [Discord Developer Portal](https://discord.com/developers/applications)
   - **Slack**: Get from [Slack API Apps](https://api.slack.com/apps)

## Railway Template Setup

### Step 1: Create the Template

1. Fork or use this repository
2. In Railway, create a new project from this GitHub repo
3. Railway will automatically detect the `Dockerfile` and `railway.toml`

### Step 2: Configure Volume

**Important**: You must add a Railway Volume for persistent storage.

1. In Railway project settings, go to "Volumes"
2. Create a new volume
3. Set mount path: `/data`
4. This ensures your configuration survives redeploys

### Step 3: Set Environment Variables

Configure these variables in Railway:

#### Recommended Variables

```
SETUP_PASSWORD=<your-strong-password>
OPENCLAW_STATE_DIR=/data/.openclaw
OPENCLAW_WORKSPACE_DIR=/data/workspace
```
The `SETUP_PASSWORD` protects your `/setup` configuration panel. If not set, a secure random password will be auto-generated and shown in the deployment logs.

#### Optional Variables

```
OPENCLAW_GATEWAY_TOKEN=<auto-generated-if-not-set>
```
If not provided, the system will auto-generate and persist a token.

### Step 4: Enable Public Networking

1. In Railway project settings, enable "Public Networking"
2. Railway will assign a domain like: `https://your-app.up.railway.app`
3. Note this URL for accessing your deployment

### Step 5: Deploy

1. Click "Deploy" in Railway
2. Wait for the build to complete (first build takes ~5-10 minutes)
3. Check deployment logs for any issues

## Post-Deployment Setup

### Initial Configuration

1. Visit `https://your-app.up.railway.app/setup`
2. Enter your `SETUP_PASSWORD`
3. Select authentication method:
   - **OAuth** (Google, GitHub, etc.) - Recommended for production
   - **Simple** (username/password) - Quick start for testing
4. Add your bot tokens:
   - Telegram bot token (optional)
   - Discord bot token (optional)
   - Slack tokens (optional)
5. Click "Run Setup"
6. Wait for onboarding to complete

### Access OpenClaw

After setup completes:

- **Gateway**: `https://your-app.up.railway.app/`
- **Control UI**: `https://your-app.up.railway.app/openclaw`
- **Setup Panel**: `https://your-app.up.railway.app/setup`

## Docker to Railway Migration

This template is optimized for Railway deployment from Docker:

### What's Included

1. **Multi-stage Dockerfile**
   - Build stage: Compiles OpenClaw from source
   - Runtime stage: Lightweight production image
   - Optimized for Railway's build system

2. **Railway-specific Configuration**
   - `railway.toml` with health checks
   - Automatic restart on failure
   - Port configuration (defaults to 8080)

3. **Volume Support**
   - Persistent storage for configuration
   - Backup/restore functionality
   - State survives redeploys

### Key Differences from Standard Docker

- **No docker-compose needed**: Railway handles orchestration
- **Automatic HTTPS**: Railway provides SSL certificates
- **Built-in logging**: Access logs via Railway dashboard
- **Zero-downtime deploys**: Railway handles rolling updates
- **Automatic scaling**: Can scale horizontally if needed

## Environment Variables Reference

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `SETUP_PASSWORD` | No | Auto-generated | Password for `/setup` access |
| `PORT` | No | 8080 | Port for web server |
| `OPENCLAW_PUBLIC_PORT` | No | 8080 | Public-facing port |
| `OPENCLAW_STATE_DIR` | No | `/data/.openclaw` | State directory path |
| `OPENCLAW_WORKSPACE_DIR` | No | `/data/workspace` | Workspace directory path |
| `OPENCLAW_GATEWAY_TOKEN` | No | Auto-generated | Gateway admin token |
| `NODE_ENV` | No | production | Node environment |
| `INTERNAL_GATEWAY_PORT` | No | 18789 | Internal gateway port |

## Troubleshooting

### Build Fails

1. Check Railway build logs for errors
2. Ensure Dockerfile is in repository root
3. Verify `railway.toml` configuration

### Setup Page Won't Load

1. Check deployment status in Railway
2. Verify public networking is enabled
3. Check health check status: `/setup/healthz`

### Configuration Lost After Redeploy

1. Ensure Volume is mounted at `/data`
2. Verify `OPENCLAW_STATE_DIR=/data/.openclaw`
3. Check volume permissions in logs

### Gateway Won't Start

1. Check logs in Railway dashboard
2. Verify all required environment variables are set
3. Check if configuration file exists: `/data/.openclaw/openclaw.json`
4. Try resetting via `/setup` panel

## Backup and Restore

### Creating a Backup

1. Go to `https://your-app.up.railway.app/setup`
2. Scroll to "Export Backup"
3. Click "Download Backup"
4. Save the `.tar.gz` file securely

### Restoring from Backup

1. Go to `https://your-app.up.railway.app/setup`
2. Scroll to "Import Backup"
3. Select your `.tar.gz` backup file
4. Click "Import"
5. Gateway will restart with restored configuration

## Advanced Configuration

### Custom OpenClaw Version

To use a specific OpenClaw version, modify the Dockerfile:

```dockerfile
ARG OPENCLAW_GIT_REF=v1.2.3
```

Then rebuild in Railway.

### Multiple Environments

Use Railway's environment feature to create:
- Development environment
- Staging environment
- Production environment

Each can have separate volumes and configurations.

### Custom Domain

1. In Railway project settings, go to "Domains"
2. Add your custom domain
3. Configure DNS according to Railway's instructions
4. SSL will be automatically provisioned

## Security Best Practices

1. **Use strong `SETUP_PASSWORD`**: At least 16 characters
2. **Enable OAuth authentication**: More secure than simple auth
3. **Regularly backup**: Use the export feature
4. **Keep OpenClaw updated**: Rebuild with latest version periodically
5. **Monitor logs**: Check Railway logs for suspicious activity
6. **Rotate tokens**: Periodically rotate bot tokens
7. **Use Railway's secrets**: Store sensitive values as environment variables

## Performance Optimization

1. **Volume I/O**: Store frequently accessed data on the volume
2. **Memory settings**: Adjust in Railway if needed (default: 512MB)
3. **Health checks**: Keep timeout reasonable (300s default)
4. **Restart policy**: `on_failure` ensures automatic recovery

## Support and Resources

- **OpenClaw Documentation**: [docs.openclaw.ai](https://docs.openclaw.ai)
- **Railway Documentation**: [docs.railway.app](https://docs.railway.app)
- **GitHub Issues**: Report bugs or request features
- **Community**: Join OpenClaw Discord/Telegram for support

## Cost Estimation

Railway pricing (as of 2024):
- **Hobby Plan**: $5/month + usage
- **Pro Plan**: $20/month + usage
- **Volume Storage**: ~$0.25/GB/month
- **Compute**: ~$0.000463/GB-second

Typical deployment:
- **Container**: ~512MB RAM = ~$3-5/month
- **Volume**: ~1GB storage = ~$0.25/month
- **Total**: ~$3-6/month on Hobby plan

## Migration from Docker Compose

If you're migrating from a `docker-compose.yml` setup:

1. **Services**: Railway handles single-service deployments by default
2. **Volumes**: Replace Docker volumes with Railway Volumes
3. **Networks**: Not needed; Railway handles networking
4. **Environment**: Move `.env` variables to Railway environment
5. **Ports**: Remove port mappings; Railway auto-assigns public URL

### Example Migration

**Before (docker-compose.yml):**
```yaml
services:
  openclaw:
    build: .
    ports:
      - "8080:8080"
    volumes:
      - ./data:/data
    environment:
      - SETUP_PASSWORD=secret
```

**After (Railway):**
- Deploy this repository to Railway
- Add Volume mounted at `/data`
- Set `SETUP_PASSWORD` environment variable
- Enable public networking
- Done! Railway handles the rest

## License

This template maintains the same license as OpenClaw. See LICENSE file for details.
